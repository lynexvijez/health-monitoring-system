<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HealthAI Monitor - AI-Powered Health Monitoring System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-card: #334155;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --accent-blue: #3b82f6;
        --accent-purple: #8b5cf6;
        --accent-green: #10b981;
        --accent-amber: #f59e0b;
        --accent-red: #ef4444;
        --border-color: #475569;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      }
      body {
        font-family: "Segoe UI", system-ui, sans-serif;
        background: linear-gradient(135deg, var(--bg-primary), #1a1a2e);
        color: var(--text-primary);
        min-height: 100vh;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(
          135deg,
          var(--accent-blue),
          var(--accent-purple)
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }
      .logo-text h1 {
        font-size: 1.4rem;
        font-weight: 700;
      }
      .logo-text p {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      /* Navigation */
      .nav {
        display: flex;
        gap: 8px;
        background: var(--bg-secondary);
        padding: 5px;
        border-radius: 12px;
      }
      .nav-btn {
        padding: 10px 20px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .nav-btn:hover {
        background: var(--bg-card);
        color: var(--text-primary);
      }
      .nav-btn.active {
        background: var(--accent-blue);
        color: white;
      }

      /* Status Bar */
      .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--bg-secondary);
        padding: 12px 20px;
        border-radius: 12px;
        margin-bottom: 20px;
      }
      .status-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--accent-green);
        animation: pulse 2s infinite;
      }
      .status-dot.paused {
        background: var(--text-muted);
        animation: none;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .control-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s;
      }
      .control-btn.pause {
        background: rgba(239, 68, 68, 0.2);
        color: var(--accent-red);
      }
      .control-btn.resume {
        background: rgba(16, 185, 129, 0.2);
        color: var(--accent-green);
      }

      /* Metrics Grid */
      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }
      .metric-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 20px;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }
      .metric-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
      }
      .metric-card.normal {
        border-color: var(--accent-green);
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.1),
          transparent
        );
      }
      .metric-card.warning {
        border-color: var(--accent-amber);
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.1),
          transparent
        );
      }
      .metric-card.critical {
        border-color: var(--accent-red);
        background: linear-gradient(
          135deg,
          rgba(239, 68, 68, 0.1),
          transparent
        );
      }
      .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      .metric-icon {
        font-size: 1.5rem;
      }
      .metric-trend {
        font-size: 1.2rem;
      }
      .metric-value {
        font-size: 2.2rem;
        font-weight: 700;
      }
      .metric-unit {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-left: 5px;
      }
      .metric-label {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-top: 5px;
      }

      /* Charts Section */
      .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }
      .chart-card {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
      }
      .chart-title {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .chart-container {
        height: 200px;
      }

      /* Recommendations & Alerts */
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
      }
      .info-card {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        max-height: 350px;
        overflow-y: auto;
      }
      .info-title {
        font-size: 1rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .recommendation-item,
      .alert-item {
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }
      .recommendation-item.success {
        background: rgba(16, 185, 129, 0.15);
        border: 1px solid rgba(16, 185, 129, 0.3);
      }
      .recommendation-item.warning {
        background: rgba(245, 158, 11, 0.15);
        border: 1px solid rgba(245, 158, 11, 0.3);
      }
      .recommendation-item.critical {
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .recommendation-item.info {
        background: rgba(59, 130, 246, 0.15);
        border: 1px solid rgba(59, 130, 246, 0.3);
      }
      .rec-icon {
        font-size: 1.2rem;
        flex-shrink: 0;
      }
      .rec-text {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }
      .alert-item {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
      }
      .alert-time {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 5px;
      }
      .no-alerts {
        text-align: center;
        color: var(--text-muted);
        padding: 30px;
      }

      /* Pages */
      .page {
        display: none;
      }
      .page.active {
        display: block;
      }

      /* Reports Page */
      .report-section {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
      }
      .report-section h3 {
        color: var(--accent-blue);
        margin-bottom: 15px;
        font-size: 1.2rem;
      }
      .report-section p {
        color: var(--text-secondary);
        line-height: 1.8;
        margin-bottom: 10px;
      }
      .report-section ul {
        color: var(--text-secondary);
        margin-left: 20px;
        line-height: 2;
      }
      .code-block {
        background: var(--bg-primary);
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        margin: 15px 0;
      }

      /* Profile Page */
      .profile-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }
      .avatar {
        width: 80px;
        height: 80px;
        background: linear-gradient(
          135deg,
          var(--accent-blue),
          var(--accent-purple)
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 700;
      }
      .profile-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }
      .profile-item {
        background: var(--bg-card);
        padding: 20px;
        border-radius: 12px;
      }
      .profile-item label {
        font-size: 0.85rem;
        color: var(--text-muted);
      }
      .profile-item value {
        display: block;
        font-size: 1.2rem;
        font-weight: 600;
        margin-top: 5px;
      }
      .health-summary {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-top: 25px;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 20px;
        color: var(--text-muted);
        font-size: 0.8rem;
        margin-top: 30px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .charts-grid,
        .info-grid {
          grid-template-columns: 1fr;
        }
        .header {
          flex-direction: column;
          text-align: center;
        }
        .nav {
          flex-wrap: wrap;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <div class="logo-icon">‚ù§Ô∏è</div>
          <div class="logo-text">
            <h1>HealthAI Monitor</h1>
            <p>AI-Powered Health Tracking System</p>
          </div>
        </div>
        <nav class="nav">
          <button class="nav-btn active" data-page="dashboard">
            üìä Dashboard
          </button>
          <button class="nav-btn" data-page="reports">üìÑ Reports</button>
          <button class="nav-btn" data-page="profile">üë§ Profile</button>
        </nav>
      </header>

      <!-- Dashboard Page -->
      <div id="dashboard" class="page active">
        <div class="status-bar">
          <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Monitoring Active</span>
          </div>
          <button
            class="control-btn pause"
            id="controlBtn"
            onclick="toggleMonitoring()"
          >
            ‚è∏ Pause
          </button>
        </div>

        <div class="metrics-grid" id="metricsGrid"></div>

        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-title">‚ù§Ô∏è Heart Rate Trend (BPM)</div>
            <div class="chart-container">
              <canvas id="heartRateChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ü´Å Blood Oxygen Trend (%)</div>
            <div class="chart-container">
              <canvas id="bloodOxygenChart"></canvas>
            </div>
          </div>
        </div>

        <div class="info-grid">
          <div class="info-card">
            <div class="info-title">‚ú® AI Recommendations</div>
            <div id="recommendations"></div>
          </div>
          <div class="info-card">
            <div class="info-title">üîî Recent Alerts</div>
            <div id="alerts"></div>
          </div>
        </div>
      </div>

      <!-- Reports Page -->
      <div id="reports" class="page">
        <div class="report-section">
          <h3>1. Project Overview</h3>
          <p>
            This AI-Powered Health Monitoring System provides real-time tracking
            and analysis of vital health metrics. The system employs machine
            learning-inspired algorithms for anomaly detection and generates
            personalized health recommendations based on continuous data
            analysis.
          </p>
        </div>
        <div class="report-section">
          <h3>2. System Architecture</h3>
          <p>
            <strong>Frontend:</strong> HTML5, CSS3, JavaScript with Chart.js for
            visualization
          </p>
          <p>
            <strong>Backend:</strong> Python Flask API with anomaly detection
            algorithms
          </p>
          <p>
            <strong>AI Engine:</strong> Isolation Forest-inspired threshold
            detection with adaptive learning
          </p>
          <p>
            <strong>Data Flow:</strong> Wearable Device ‚Üí API ‚Üí AI Processing ‚Üí
            Real-time Dashboard
          </p>
        </div>
        <div class="report-section">
          <h3>3. Anomaly Detection Parameters</h3>
          <ul>
            <li>
              Heart Rate: Normal 55-100 BPM | Warning &lt;55 or &gt;100 |
              Critical &lt;45 or &gt;120
            </li>
            <li>
              Blood Oxygen: Normal 94-100% | Warning 90-94% | Critical &lt;90%
            </li>
            <li>
              Sleep Quality: Scored 0-100 based on duration and interruptions
            </li>
            <li>
              Activity Level: Calculated from steps, movement intensity, and
              duration
            </li>
          </ul>
        </div>
        <div class="report-section">
          <h3>4. Python Backend Code</h3>
          <div class="code-block">
            <pre>
from flask import Flask, jsonify
from sklearn.ensemble import IsolationForest
import numpy as np

app = Flask(__name__)

# Anomaly Detection Model
class HealthAnomalyDetector:
    def __init__(self):
        self.thresholds = {
            'heart_rate': {'low': 55, 'high': 100},
            'blood_oxygen': {'low': 94, 'high': 100}
        }
    
    def detect(self, metric, value):
        t = self.thresholds.get(metric)
        if value < t['low'] * 0.8 or value > t['high'] * 1.2:
            return 'critical'
        elif value < t['low'] or value > t['high']:
            return 'warning'
        return 'normal'

@app.route('/api/health-data')
def get_health_data():
    return jsonify({
        'heart_rate': np.random.randint(60, 95),
        'blood_oxygen': round(np.random.uniform(95, 99), 1)
    })</pre
            >
          </div>
        </div>
        <div class="report-section">
          <h3>5. Key Features Implemented</h3>
          <ul>
            <li>
              Real-time health metric monitoring with 2-second refresh intervals
            </li>
            <li>Automated anomaly detection with three severity levels</li>
            <li>AI-powered personalized health recommendations</li>
            <li>Interactive data visualization with trend analysis</li>
            <li>Alert logging system for detected anomalies</li>
            <li>Responsive design for mobile and desktop viewing</li>
          </ul>
        </div>
      </div>

      <!-- Profile Page -->
      <div id="profile" class="page">
        <div class="report-section">
          <div class="profile-header">
            <div class="avatar">JD</div>
            <div>
              <h2>Felix Joshua</h2>
              <p style="color: var(--text-secondary)">
                Premium Member ‚Ä¢ Connected Device: Fitbit Sense 2
              </p>
            </div>
          </div>
          <div class="profile-grid">
            <div class="profile-item">
              <label>Age</label><value>20 yrs</value>
            </div>
            <div class="profile-item">
              <label>Height</label><value>5'10" (178 cm)</value>
            </div>
            <div class="profile-item">
              <label>Weight</label><value>165 lbs (75 kg)</value>
            </div>
            <div class="profile-item">
              <label>Blood Type</label><value>O+</value>
            </div>
            <div class="profile-item">
              <label>Resting HR</label><value>68 BPM</value>
            </div>
            <div class="profile-item">
              <label>Avg SpO2</label><value>97.5%</value>
            </div>
          </div>
          <div class="health-summary">
            <h4 style="color: var(--accent-green); margin-bottom: 10px">
              ‚úÖ Health Summary
            </h4>
            <p style="color: var(--text-secondary)">
              Based on your recent data analysis, your overall health status is
              <strong>Good</strong>. Your heart rate variability shows healthy
              patterns, and blood oxygen levels remain consistently optimal.
              Continue maintaining your current activity level and sleep
              schedule for best results.
            </p>
          </div>
        </div>
      </div>

      <footer class="footer">
        <p>
          AI Health Monitoring System v1.0 | For Demonstration Purposes Only |
          Not Medical Advice
        </p>
        <p style="margin-top: 5px">¬© 2025 Lynex Softwares</p>
      </footer>
    </div>

    <script>
      // Health Monitoring System - JavaScript Implementation

      // State Management
      const state = {
        isMonitoring: true,
        healthData: [],
        alerts: [],
        currentMetrics: null,
      };

      // Thresholds for Anomaly Detection
      const thresholds = {
        heartRate: { low: 55, high: 100, criticalLow: 45, criticalHigh: 120 },
        bloodOxygen: { low: 94, high: 100, criticalLow: 90, criticalHigh: 100 },
        sleepQuality: { low: 40, high: 100 },
        activityLevel: { low: 20, high: 100 },
      };

      // Chart instances
      let heartRateChart, bloodOxygenChart;

      // Initialize Charts
      function initCharts() {
        const chartConfig = (label, borderColor, bgColor) => ({
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label,
                data: [],
                borderColor,
                backgroundColor: bgColor,
                fill: true,
                tension: 0.4,
                pointRadius: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: {
                grid: { color: "#334155" },
                ticks: { color: "#94a3b8", maxTicksLimit: 8 },
              },
              y: { grid: { color: "#334155" }, ticks: { color: "#94a3b8" } },
            },
          },
        });

        heartRateChart = new Chart(
          document.getElementById("heartRateChart"),
          chartConfig("Heart Rate", "#ef4444", "rgba(239,68,68,0.1)")
        );
        bloodOxygenChart = new Chart(
          document.getElementById("bloodOxygenChart"),
          chartConfig("Blood Oxygen", "#3b82f6", "rgba(59,130,246,0.1)")
        );
      }

      // Anomaly Detection Algorithm
      function detectAnomaly(value, metric) {
        const t = thresholds[metric];
        if (!t) return { status: "normal", severity: 1 };
        if (
          value <= (t.criticalLow || t.low * 0.8) ||
          value >= (t.criticalHigh || t.high * 1.2)
        )
          return { status: "critical", severity: 3 };
        if (value < t.low || value > t.high)
          return { status: "warning", severity: 2 };
        return { status: "normal", severity: 1 };
      }

      // Generate Simulated Health Data
      function generateHealthData() {
        const prev = state.healthData[state.healthData.length - 1];
        const vary = (base, range, min, max) =>
          Math.max(min, Math.min(max, base + (Math.random() - 0.5) * range));

        return {
          timestamp: new Date().toLocaleTimeString(),
          heartRate: Math.round(
            prev ? vary(prev.heartRate, 8, 50, 130) : 70 + Math.random() * 20
          ),
          bloodOxygen:
            Math.round(
              (prev
                ? vary(prev.bloodOxygen, 2, 88, 100)
                : 95 + Math.random() * 4) * 10
            ) / 10,
          sleepQuality: Math.round(
            prev ? prev.sleepQuality : 60 + Math.random() * 30
          ),
          activityLevel: Math.round(
            prev
              ? vary(prev.activityLevel, 15, 10, 100)
              : 40 + Math.random() * 40
          ),
        };
      }

      // AI Recommendation Engine
      function getRecommendations(metrics) {
        const recs = [];
        const { heartRate, bloodOxygen, sleepQuality, activityLevel } = metrics;

        if (heartRate > 100)
          recs.push({
            type: "warning",
            icon: "‚ù§Ô∏è",
            text: "Elevated heart rate detected. Consider relaxation techniques, deep breathing, or reducing caffeine intake.",
          });
        else if (heartRate < 55)
          recs.push({
            type: "warning",
            icon: "‚ù§Ô∏è",
            text: "Low heart rate detected. If experiencing dizziness or fatigue, consult a healthcare provider.",
          });
        else
          recs.push({
            type: "success",
            icon: "‚ù§Ô∏è",
            text: "Heart rate is within healthy range. Your cardiovascular system is functioning well!",
          });

        if (bloodOxygen < 94)
          recs.push({
            type: "critical",
            icon: "ü´Å",
            text: "Blood oxygen below normal range. Practice deep breathing exercises. Seek medical attention if symptoms persist.",
          });
        else
          recs.push({
            type: "success",
            icon: "ü´Å",
            text: "Blood oxygen levels are excellent. Your respiratory function is optimal.",
          });

        if (sleepQuality < 50)
          recs.push({
            type: "warning",
            icon: "üò¥",
            text: "Sleep quality needs improvement. Try maintaining a consistent sleep schedule and limiting screen time before bed.",
          });
        else
          recs.push({
            type: "success",
            icon: "üò¥",
            text: "Good sleep quality detected. Quality rest supports your overall health and recovery.",
          });

        if (activityLevel < 30)
          recs.push({
            type: "info",
            icon: "üèÉ",
            text: "Activity level is low today. Aim for at least 30 minutes of moderate exercise for optimal health.",
          });
        else if (activityLevel > 70)
          recs.push({
            type: "success",
            icon: "üèÉ",
            text: "Excellent activity level! Remember to stay hydrated and allow adequate recovery time.",
          });

        return recs;
      }

      // Render Metrics Cards
      function renderMetrics(metrics) {
        const metricsConfig = [
          { key: "heartRate", label: "Heart Rate", unit: "BPM", icon: "‚ù§Ô∏è" },
          { key: "bloodOxygen", label: "Blood Oxygen", unit: "%", icon: "ü´Å" },
          {
            key: "sleepQuality",
            label: "Sleep Quality",
            unit: "%",
            icon: "üò¥",
          },
          {
            key: "activityLevel",
            label: "Activity Level",
            unit: "%",
            icon: "üèÉ",
          },
        ];

        const prev = state.healthData[state.healthData.length - 2];

        document.getElementById("metricsGrid").innerHTML = metricsConfig
          .map((m) => {
            const value = metrics[m.key];
            const { status } = detectAnomaly(value, m.key);
            const trend = prev
              ? value > prev[m.key]
                ? "‚Üë"
                : value < prev[m.key]
                ? "‚Üì"
                : "‚Üí"
              : "‚Üí";

            return `
                    <div class="metric-card ${status}">
                        <div class="metric-header">
                            <span class="metric-icon">${m.icon}</span>
                            <span class="metric-trend">${trend}</span>
                        </div>
                        <div class="metric-value">${value}<span class="metric-unit">${m.unit}</span></div>
                        <div class="metric-label">${m.label}</div>
                    </div>
                `;
          })
          .join("");
      }

      // Render Recommendations
      function renderRecommendations(metrics) {
        const recs = getRecommendations(metrics);
        document.getElementById("recommendations").innerHTML = recs
          .map(
            (r) => `
                <div class="recommendation-item ${r.type}">
                    <span class="rec-icon">${r.icon}</span>
                    <span class="rec-text">${r.text}</span>
                </div>
            `
          )
          .join("");
      }

      // Render Alerts
      function renderAlerts() {
        const alertsEl = document.getElementById("alerts");
        if (state.alerts.length === 0) {
          alertsEl.innerHTML =
            '<div class="no-alerts">‚úÖ No anomalies detected</div>';
          return;
        }
        alertsEl.innerHTML = state.alerts
          .slice(0, 8)
          .map(
            (a) => `
                <div class="alert-item">
                    <span class="rec-icon">${
                      a.severity >= 3 ? "üî¥" : "üü°"
                    }</span>
                    <div>
                        <div class="rec-text">${a.message}</div>
                        <div class="alert-time">${a.time}</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Update Charts
      function updateCharts(data) {
        const maxPoints = 20;

        heartRateChart.data.labels = data
          .slice(-maxPoints)
          .map((d) => d.timestamp);
        heartRateChart.data.datasets[0].data = data
          .slice(-maxPoints)
          .map((d) => d.heartRate);
        heartRateChart.update("none");

        bloodOxygenChart.data.labels = data
          .slice(-maxPoints)
          .map((d) => d.timestamp);
        bloodOxygenChart.data.datasets[0].data = data
          .slice(-maxPoints)
          .map((d) => d.bloodOxygen);
        bloodOxygenChart.update("none");
      }

      // Main Update Loop
      async function updateHealthData() {
        if (!state.isMonitoring) return;

        // Try fetching live data from backend API, fallback to simulated data on error
        const apiUrl = "http://localhost:5000/api/health";
        let newData;
        try {
          const response = await fetch(apiUrl);
          if (!response.ok) throw new Error("Network response was not ok");
          const api = await response.json();

          newData = {
            timestamp: new Date().toLocaleTimeString(),
            // map API fields to frontend camelCase; fall back to small random values if missing
            heartRate: Math.round(api.heart_rate ?? 70 + Math.random() * 20),
            bloodOxygen:
              Math.round((api.blood_oxygen ?? 95 + Math.random() * 4) * 10) /
              10,
            sleepQuality: Math.round(
              api.sleep_quality ?? 60 + Math.random() * 30
            ),
            activityLevel: Math.round(
              api.activity_level ?? 40 + Math.random() * 40
            ),
          };
        } catch (err) {
          // Fallback to simulated generator when API fails
          newData = generateHealthData();
          console.warn("API fetch failed, using simulated data:", err);
        }

        state.healthData.push(newData);
        state.currentMetrics = newData;

        // Check for anomalies
        const hrAnomaly = detectAnomaly(newData.heartRate, "heartRate");
        const boAnomaly = detectAnomaly(newData.bloodOxygen, "bloodOxygen");

        if (hrAnomaly.status !== "normal") {
          state.alerts.unshift({
            id: Date.now(),
            time: newData.timestamp,
            message: `Heart rate anomaly: ${newData.heartRate} BPM`,
            severity: hrAnomaly.severity,
          });
        }
        if (boAnomaly.status !== "normal") {
          state.alerts.unshift({
            id: Date.now(),
            time: newData.timestamp,
            message: `Blood oxygen anomaly: ${newData.bloodOxygen}%`,
            severity: boAnomaly.severity,
          });
        }
        state.alerts = state.alerts.slice(0, 20);

        renderMetrics(newData);
        renderRecommendations(newData);
        renderAlerts();
        updateCharts(state.healthData);
      }

      // Toggle Monitoring
      function toggleMonitoring() {
        state.isMonitoring = !state.isMonitoring;
        const btn = document.getElementById("controlBtn");
        const dot = document.getElementById("statusDot");
        const text = document.getElementById("statusText");

        if (state.isMonitoring) {
          btn.className = "control-btn pause";
          btn.innerHTML = "‚è∏ Pause";
          dot.classList.remove("paused");
          text.textContent = "Monitoring Active";
        } else {
          btn.className = "control-btn resume";
          btn.innerHTML = "‚ñ∂ Resume";
          dot.classList.add("paused");
          text.textContent = "Monitoring Paused";
        }
      }

      // Page Navigation
      document.querySelectorAll(".nav-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".nav-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".page")
            .forEach((p) => p.classList.remove("active"));
          btn.classList.add("active");
          document.getElementById(btn.dataset.page).classList.add("active");
        });
      });

      // Initialize Application
      function init() {
        initCharts();
        updateHealthData();
        setInterval(() => updateHealthData(), 2000);
      }

      init();
    </script>
  </body>
</html>
